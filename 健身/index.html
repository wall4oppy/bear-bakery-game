<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitnessPro - å¥èº«éŠæˆ²App</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 414px;
            margin: 0 auto;
            background: #f8f9fa;
            min-height: 100vh;
            position: relative;
            padding-bottom: 80px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 20px 30px;
            border-radius: 0 0 25px 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }

        .avatar:hover {
            border-color: #fff;
            transform: scale(1.05);
        }

        .user-level {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .welcome-text {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .streak-info {
            font-size: 14px;
            opacity: 0.9;
        }

        .main-content {
            padding: 20px;
            display: none;
        }

        .main-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .card-icon {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #f1f3f4;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e8eaed;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .checkin-container {
            text-align: center;
        }

        .checkin-days {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
            margin: 10px 0;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .xp-info {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #666;
        }

        .chart-container {
            position: relative;
            height: 200px;
            margin: 20px 0;
        }

        .chart-small {
            height: 150px;
        }

        .tasks-list {
            list-style: none;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            gap: 12px;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .task-checkbox.completed {
            background: #667eea;
            border-color: #667eea;
            position: relative;
        }

        .task-checkbox.completed::after {
            content: 'âœ“';
            color: white;
            font-size: 12px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .task-text {
            flex: 1;
            font-size: 14px;
        }

        .task-text.completed {
            text-decoration: line-through;
            color: #999;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .achievement-badge {
            aspect-ratio: 1;
            background: #f8f9fa;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .achievement-badge.unlocked {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
            animation: badgeUnlock 0.5s ease;
        }

        @keyframes badgeUnlock {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .achievement-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .achievement-title {
            font-size: 10px;
            text-align: center;
            font-weight: 500;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            gap: 15px;
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .rank-number {
            width: 30px;
            height: 30px;
            background: #f1f3f4;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .rank-number.top3 {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 500;
            font-size: 14px;
        }

        .user-stats {
            font-size: 12px;
            color: #666;
        }

        .recipe-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .recipe-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .recipe-content {
            padding: 15px;
        }

        .recipe-title {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .recipe-nutrients {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            margin-bottom: 12px;
        }

        .comparison-container {
            display: flex;
            gap: 15px;
            margin: 15px 0;
        }

        .comparison-item {
            flex: 1;
            text-align: center;
        }

        .comparison-image {
            width: 100%;
            height: 200px;
            border-radius: 15px;
            object-fit: cover;
            margin-bottom: 10px;
        }

        .comparison-label {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .comparison-stats {
            font-size: 12px;
            color: #666;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 414px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px;
        }

        .nav-item.active {
            color: #667eea;
        }

        .nav-item:hover {
            background: #f8f9fa;
            border-radius: 10px;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }

        .flow-meter {
            text-align: center;
            margin: 20px 0;
        }

        .flow-percentage {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            margin-top: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px;
            max-width: 300px;
            text-align: center;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .level-up-icon {
            font-size: 60px;
            color: #667eea;
            margin-bottom: 15px;
        }

        .offline-banner {
            background: #ff6b6b;
            color: white;
            text-align: center;
            padding: 10px;
            font-size: 14px;
            display: none;
        }

        @media (max-width: 480px) {
            .container {
                max-width: 100%;
            }
            
            .header {
                border-radius: 0 0 20px 20px;
            }
            
            .card {
                margin: 10px;
                border-radius: 15px;
            }
        }

        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="offline-banner" id="offlineBanner">
        <i class="fas fa-wifi"></i> ç¶²è·¯é€£ç·šä¸­æ–·ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½ç„¡æ³•ä½¿ç”¨
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="user-info">
                    <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face" 
                         alt="ç”¨æˆ¶é ­åƒ" class="avatar" id="userAvatar">
                    <div>
                        <div class="user-level" id="userLevel">LV 1</div>
                    </div>
                </div>
                <div class="user-info">
                    <i class="fas fa-fire" style="color: #ff6b6b;"></i>
                    <span id="checkinStreak">0</span>
                </div>
            </div>
            <div class="welcome-text" id="welcomeText">æ—©å®‰ï¼Œå¥èº«å‹‡è€…ï¼</div>
            <div class="streak-info">ä»Šå¤©ä¹Ÿè¦ä¿æŒæ´»åŠ›å–” ğŸ’ª</div>
        </div>

        <!-- é¦–é å…§å®¹ -->
        <div class="main-content active" id="homeContent">
            <!-- æ¯æ—¥ç°½åˆ° -->
            <div class="card fade-in">
                <div class="card-header">
                    <h3 class="card-title">æ¯æ—¥ç°½åˆ°</h3>
                    <div class="card-icon"><i class="fas fa-calendar-check"></i></div>
                </div>
                <div class="checkin-container">
                    <div class="checkin-days" id="checkinDays">0</div>
                    <p>é€£çºŒæ‰“å¡å¤©æ•¸</p>
                    <button class="btn" id="checkinBtn" onclick="dailyCheckin()">
                        <i class="fas fa-check"></i> ä»Šæ—¥ç°½åˆ°
                    </button>
                </div>
            </div>

            <!-- ç­‰ç´šç³»çµ± -->
            <div class="card fade-in">
                <div class="card-header">
                    <h3 class="card-title">ç­‰ç´šé€²åº¦</h3>
                    <div class="card-icon"><i class="fas fa-star"></i></div>
                </div>
                <div class="chart-container chart-small">
                    <canvas id="xpChart"></canvas>
                </div>
                <div class="xp-info">
                    <span id="currentXP">0 XP</span>
                    <span id="nextLevelXP">/ 100 XP</span>
                </div>
            </div>

            <!-- Flow Meter -->
            <div class="card fade-in">
                <div class="card-header">
                    <h3 class="card-title">å¿ƒæµç‹€æ…‹</h3>
                    <div class="card-icon"><i class="fas fa-bolt"></i></div>
                </div>
                <div class="flow-meter">
                    <div class="chart-container chart-small">
                        <canvas id="flowChart"></canvas>
                    </div>
                    <div class="flow-percentage" id="flowPercentage">0%</div>
                    <p>å®Œæˆä»»å‹™ç²å¾—å¿ƒæµåŠ æˆ</p>
                </div>
            </div>

            <!-- ä»Šæ—¥ä»»å‹™ -->
            <div class="card fade-in">
                <div class="card-header">
                    <h3 class="card-title">ä»Šæ—¥ä»»å‹™</h3>
                    <div class="card-icon"><i class="fas fa-tasks"></i></div>
                </div>
                <ul class="tasks-list" id="tasksList">
                    <!-- å‹•æ…‹ç”Ÿæˆä»»å‹™ -->
                </ul>
                <button class="btn btn-secondary" onclick="generateDailyTasks()">
                    <i class="fas fa-refresh"></i> é‡æ–°ç”Ÿæˆä»»å‹™
                </button>
            </div>
        </div>

        <!-- è¨“ç·´å…§å®¹ -->
        <div class="main-content" id="workoutContent">
            <div class="card fade-in">
                <div class="card-header">
                    <h3 class="card-title">è¨“ç·´çµ±è¨ˆ</h3>
                    <div class="card-icon"><i class="fas fa-dumbbell"></i></div>
                </div>
                <p>æœ¬é€±å®Œæˆ 3 æ¬¡è¨“ç·´</p>
                <p>ç‡ƒç‡’å¡è·¯é‡Œï¼š1,250 cal</p>
                <button class="btn">é–‹å§‹ä»Šæ—¥è¨“ç·´</button>
            </div>
        </div>

        <!-- é£²é£Ÿå…§å®¹ -->
        <div class="main-content" id="dietContent">
            <!-- ç‡Ÿé¤Šåˆ†æ -->
            <div class="card fade-in">
                <div class="card-header">
                    <h3 class="card-title">ä»Šæ—¥ç‡Ÿé¤Š</h3>
                    <div class="card-icon"><i class="fas fa-apple-alt"></i></div>
                </div>
                <div class="chart-container chart-small">
                    <canvas id="nutritionChart"></canvas>
                </div>
            </div>

            <!-- é£Ÿè­œæ¨è–¦ -->
            <div class="card fade-in">
                <div class="card-header">
                    <h3 class="card-title">æ¨è–¦é£Ÿè­œ</h3>
                    <div class="card-icon"><i class="fas fa-utensils"></i></div>
                </div>
                <div id="recipeContainer">
                    <!-- å‹•æ…‹ç”Ÿæˆé£Ÿè­œ -->
                </div>
                <button class="btn btn-secondary" onclick="loadRecipes()">
                    <i class="fas fa-refresh"></i> æ›´å¤šé£Ÿè­œ
                </button>
            </div>
        </div>

        <!-- Avatarå…§å®¹ -->
        <div class="main-content" id="avatarContent">
            <!-- Avatarå±•ç¤º -->
            <div class="card fade-in">
                <div class="card-header">
                    <h3 class="card-title">æˆ‘çš„Avatar</h3>
                    <div class="card-icon"><i class="fas fa-user-ninja"></i></div>
                </div>
                <div style="text-align: center;">
                    <img src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=200&h=200&fit=crop" 
                         alt="Avatar" id="avatarDisplay" style="width: 150px; height: 150px; border-radius: 15px; margin: 20px 0;">
                    <p id="avatarDescription">é‹å‹•æ–°æ‰‹è£å‚™</p>
                </div>
            </div>

            <!-- èº«æå°æ¯” -->
            <div class="card fade-in">
                <div class="card-header">
                    <h3 class="card-title">èº«æå°æ¯”</h3>
                    <div class="card-icon"><i class="fas fa-chart-line"></i></div>
                </div>
                <div class="comparison-container">
                    <div class="comparison-item">
                        <img src="https://images.unsplash.com/photo-1594736797933-d0f5e0822dd3?w=200&h=200&fit=crop" 
                             alt="éå»" class="comparison-image">
                        <div class="comparison-label">3å€‹æœˆå‰</div>
                        <div class="comparison-stats">75kg | 22% é«”è„‚</div>
                    </div>
                    <div class="comparison-item">
                        <img src="https://images.unsplash.com/photo-1583454110551-21f2fa2afe61?w=200&h=200&fit=crop" 
                             alt="ç¾åœ¨" class="comparison-image">
                        <div class="comparison-label">ç¾åœ¨</div>
                        <div class="comparison-stats">72kg | 18% é«”è„‚</div>
                    </div>
                </div>
            </div>

            <!-- æˆå°±ç³»çµ± -->
            <div class="card fade-in">
                <div class="card-header">
                    <h3 class="card-title">æˆå°±å¾½ç« </h3>
                    <div class="card-icon"><i class="fas fa-trophy"></i></div>
                </div>
                <div class="achievements-grid" id="achievementsGrid">
                    <!-- å‹•æ…‹ç”Ÿæˆæˆå°± -->
                </div>
            </div>
        </div>

        <!-- è¨­å®šå…§å®¹ -->
        <div class="main-content" id="settingsContent">
            <!-- æ’è¡Œæ¦œ -->
            <div class="card fade-in">
                <div class="card-header">
                    <h3 class="card-title">æ’è¡Œæ¦œ</h3>
                    <div class="card-icon"><i class="fas fa-crown"></i></div>
                </div>
                <div id="leaderboardContainer">
                    <!-- å‹•æ…‹ç”Ÿæˆæ’è¡Œæ¦œ -->
                </div>
            </div>

            <div class="card fade-in">
                <div class="card-header">
                    <h3 class="card-title">è¨­å®š</h3>
                    <div class="card-icon"><i class="fas fa-cog"></i></div>
                </div>
                <button class="btn btn-secondary">å€‹äººè³‡æ–™</button>
                <button class="btn btn-secondary" style="margin-top: 10px;">é€šçŸ¥è¨­å®š</button>
                <button class="btn btn-secondary" style="margin-top: 10px;">éš±ç§æ”¿ç­–</button>
            </div>
        </div>

        <!-- åº•éƒ¨å°èˆª -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('home')">
                <div class="nav-icon"><i class="fas fa-home"></i></div>
                <div class="nav-label">é¦–é </div>
            </div>
            <div class="nav-item" onclick="switchTab('workout')">
                <div class="nav-icon"><i class="fas fa-dumbbell"></i></div>
                <div class="nav-label">è¨“ç·´</div>
            </div>
            <div class="nav-item" onclick="switchTab('diet')">
                <div class="nav-icon"><i class="fas fa-apple-alt"></i></div>
                <div class="nav-label">é£²é£Ÿ</div>
            </div>
            <div class="nav-item" onclick="switchTab('avatar')">
                <div class="nav-icon"><i class="fas fa-user"></i></div>
                <div class="nav-label">Avatar</div>
            </div>
            <div class="nav-item" onclick="switchTab('settings')">
                <div class="nav-icon"><i class="fas fa-cog"></i></div>
                <div class="nav-label">è¨­å®š</div>
            </div>
        </div>
    </div>

    <!-- å‡ç´šå½ˆçª— -->
    <div class="modal" id="levelUpModal">
        <div class="modal-content">
            <div class="level-up-icon">ğŸ‰</div>
            <h3>æ­å–œå‡ç´šï¼</h3>
            <p id="levelUpText">æ‚¨å·²é”åˆ°ç­‰ç´š 2</p>
            <button class="btn" onclick="closeLevelUpModal()">å¤ªæ£’äº†ï¼</button>
        </div>
    </div>

    <script>
        // Firebase æ¨¡æ“¬é…ç½®
        const firebaseConfig = {
            // æ¨¡æ“¬é…ç½®
            apiKey: "æ¨¡æ“¬-api-key",
            authDomain: "fitness-app.firebaseapp.com",
            projectId: "fitness-app",
            storageBucket: "fitness-app.appspot.com",
            messagingSenderId: "123456789",
            appId: "æ¨¡æ“¬-app-id"
        };

        // æ¨¡æ“¬ç”¨æˆ¶æ•¸æ“š
        let userData = {
            profile: {
                name: "å¥èº«å‹‡è€…",
                avatarUrl: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face",
                email: "user@fitness.com"
            },
            stats: {
                level: 1,
                XP: 0,
                flowState: 0,
                currentWeight: 72,
                bodyFat: 18
            },
            progress: {
                checkinDays: [],
                workoutHistory: [],
                dietHistory: [],
                unlockedAchievements: [],
                avatarItems: ['basic']
            },
            tasks: {
                todayTasks: []
            },
            leaderboardSnapshot: {
                XP: 0,
                checkinStreak: 0,
                taskCompletionRate: 0
            }
        };

        // æ¨¡æ“¬æ’è¡Œæ¦œæ•¸æ“š
        const leaderboardData = [
            { name: "å¥èº«é”äºº", avatar: "https://images.unsplash.com/photo-1517849845537-4d257902454a?w=50&h=50&fit=crop&crop=face", level: 15, XP: 1500 },
            { name: "é‹å‹•å¥³ç¥", avatar: "https://images.unsplash.com/photo-1494790108755-2616b612b3e5?w=50&h=50&fit=crop&crop=face", level: 12, XP: 1200 },
            { name: "è‚Œè‚‰çŒ›ç”·", avatar: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=50&h=50&fit=crop&crop=face", level: 10, XP: 1000 },
            { name: "ç‘œä¼½å¤§å¸«", avatar: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=50&h=50&fit=crop&crop=face", level: 8, XP: 800 },
            { name: "è·‘æ­¥ç‹‚äºº", avatar: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=50&h=50&fit=crop&crop=face", level: 7, XP: 700 }
        ];

        // æˆå°±æ•¸æ“š
        const achievements = [
            { id: 'first_checkin', title: 'åˆæ¬¡ç°½åˆ°', icon: 'ğŸ“…', condition: 'checkin_1', unlocked: false },
            { id: 'week_streak', title: 'é€£çºŒ7å¤©', icon: 'ğŸ”¥', condition: 'checkin_7', unlocked: false },
            { id: 'level_5', title: 'ç­‰ç´š5', icon: 'â­', condition: 'level_5', unlocked: false },
            { id: 'diet_master', title: 'é£²é£Ÿé”äºº', icon: 'ğŸ', condition: 'diet_perfect', unlocked: false },
            { id: 'workout_beast', title: 'è¨“ç·´é‡ç¸', icon: 'ğŸ’ª', condition: 'workout_10', unlocked: false },
            { id: 'flow_master', title: 'å¿ƒæµå¤§å¸«', icon: 'âš¡', condition: 'flow_100', unlocked: false }
        ];

        // é£Ÿè­œæ•¸æ“š
        const recipes = [
            {
                title: "é›èƒ¸è‚‰æ²™æ‹‰",
                image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=300&h=200&fit=crop",
                calories: 320,
                protein: 35,
                carbs: 12,
                fat: 8
            },
            {
                title: "é®­é­šé…ªæ¢¨å·",
                image: "https://images.unsplash.com/photo-1579952363873-27d3bfad9c0d?w=300&h=200&fit=crop",
                calories: 280,
                protein: 25,
                carbs: 8,
                fat: 15
            },
            {
                title: "è›‹ç™½è³ªå¥¶æ˜”",
                image: "https://images.unsplash.com/photo-1610970881699-44a5587cabec?w=300&h=200&fit=crop",
                calories: 250,
                protein: 30,
                carbs: 15,
                fat: 5
            }
        ];

        // Chart.js åœ–è¡¨
        let xpChart, flowChart, nutritionChart;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadUserData();
            updateUI();
            generateDailyTasks();
            loadRecipes();
            loadLeaderboard();
            loadAchievements();
            checkNetworkStatus();
        });

        function initializeApp() {
            console.log('FitnessPro App åˆå§‹åŒ–æˆåŠŸ');
            
            // åˆå§‹åŒ–åœ–è¡¨
            setTimeout(() => {
                initializeCharts();
            }, 100);
        }

        function loadUserData() {
            // å¾ localStorage è®€å–æ•¸æ“šï¼ˆæ¨¡æ“¬ Firebaseï¼‰
            const saved = localStorage.getItem('fitnessUserData');
            if (saved) {
                userData = { ...userData, ...JSON.parse(saved) };
            }
        }

        function saveUserData() {
            // ä¿å­˜åˆ° localStorageï¼ˆæ¨¡æ“¬ Firebaseï¼‰
            localStorage.setItem('fitnessUserData', JSON.stringify(userData));
        }

        function updateUI() {
            // æ›´æ–°ç”¨æˆ¶é ­åƒå’Œç­‰ç´š
            document.getElementById('userAvatar').src = userData.profile.avatarUrl;
            document.getElementById('userLevel').textContent = `LV ${userData.stats.level}`;
            document.getElementById('checkinStreak').textContent = userData.progress.checkinDays.length;
            document.getElementById('welcomeText').textContent = getWelcomeMessage();
            
            // æ›´æ–°ç°½åˆ°å¤©æ•¸
            document.getElementById('checkinDays').textContent = userData.progress.checkinDays.length;
            
            // æ›´æ–°XPä¿¡æ¯
            const currentXP = userData.stats.XP;
            const nextLevelXP = userData.stats.level * 100;
            document.getElementById('currentXP').textContent = `${currentXP} XP`;
            document.getElementById('nextLevelXP').textContent = `/ ${nextLevelXP} XP`;
            
            // æ›´æ–°Flowç‹€æ…‹
            document.getElementById('flowPercentage').textContent = `${userData.stats.flowState}%`;
            
            // æ›´æ–°Avatar
            updateAvatar();
            
            // æª¢æŸ¥ç°½åˆ°æŒ‰éˆ•ç‹€æ…‹
            checkCheckinStatus();
        }

        function getWelcomeMessage() {
            const hour = new Date().getHours();
            if (hour < 12) return "æ—©å®‰ï¼Œå¥èº«å‹‡è€…ï¼";
            if (hour < 18) return "åˆå®‰ï¼Œå¥èº«å‹‡è€…ï¼";
            return "æ™šå®‰ï¼Œå¥èº«å‹‡è€…ï¼";
        }

        function checkCheckinStatus() {
            const today = new Date().toDateString();
            const lastCheckin = userData.progress.checkinDays[userData.progress.checkinDays.length - 1];
            const checkinBtn = document.getElementById('checkinBtn');
            
            if (lastCheckin && new Date(lastCheckin).toDateString() === today) {
                checkinBtn.textContent = 'âœ… ä»Šæ—¥å·²ç°½åˆ°';
                checkinBtn.disabled = true;
                checkinBtn.style.opacity = '0.6';
            }
        }

        function dailyCheckin() {
            const today = new Date().toISOString();
            const checkinBtn = document.getElementById('checkinBtn');
            
            // æ·»åŠ ç°½åˆ°è¨˜éŒ„
            userData.progress.checkinDays.push(today);
            
            // å¢åŠ XP
            userData.stats.XP += 10;
            
            // æª¢æŸ¥å‡ç´š
            checkLevelUp();
            
            // æª¢æŸ¥æˆå°±
            checkAchievements();
            
            // æ›´æ–°UI
            updateUI();
            
            // æ›´æ–°åœ–è¡¨
            updateCharts();
            
            // ä¿å­˜æ•¸æ“š
            saveUserData();
            
            // ç°½åˆ°å‹•ç•«
            checkinBtn.innerHTML = '<i class="fas fa-check"></i> ç°½åˆ°æˆåŠŸï¼';
            checkinBtn.style.transform = 'scale(1.1)';
            setTimeout(() => {
                checkinBtn.style.transform = 'scale(1)';
                checkinBtn.textContent = 'âœ… ä»Šæ—¥å·²ç°½åˆ°';
                checkinBtn.disabled = true;
                checkinBtn.style.opacity = '0.6';
            }, 500);
        }

        function checkLevelUp() {
            const currentLevel = userData.stats.level;
            const requiredXP = currentLevel * 100;
            
            if (userData.stats.XP >= requiredXP) {
                userData.stats.level++;
                userData.stats.XP = 0; // é‡ç½®XPæˆ–è¨ˆç®—å‰©é¤˜XP
                showLevelUpModal(userData.stats.level);
            }
        }

        function showLevelUpModal(newLevel) {
            document.getElementById('levelUpText').textContent = `æ‚¨å·²é”åˆ°ç­‰ç´š ${newLevel}ï¼`;
            document.getElementById('levelUpModal').classList.add('show');
        }

        function closeLevelUpModal() {
            document.getElementById('levelUpModal').classList.remove('show');
        }

        function generateDailyTasks() {
            const tasks = [
                { title: "å– 8 æ¯æ°´", type: "hydration", completed: false },
                { title: "å®Œæˆ 30 åˆ†é˜æœ‰æ°§é‹å‹•", type: "cardio", completed: false },
                { title: "æ”å– 100g è›‹ç™½è³ª", type: "nutrition", completed: false },
                { title: "æ­¥è¡Œ 10,000 æ­¥", type: "walking", completed: false },
                { title: "å†¥æƒ³ 10 åˆ†é˜", type: "meditation", completed: false }
            ];
            
            // éš¨æ©Ÿé¸æ“‡3å€‹ä»»å‹™
            const todayTasks = tasks.sort(() => 0.5 - Math.random()).slice(0, 3);
            userData.tasks.todayTasks = todayTasks;
            
            renderTasks();
            saveUserData();
        }

        function renderTasks() {
            const tasksList = document.getElementById('tasksList');
            tasksList.innerHTML = '';
            
            userData.tasks.todayTasks.forEach((task, index) => {
                const taskItem = document.createElement('li');
                taskItem.className = 'task-item';
                taskItem.innerHTML = `
                    <div class="task-checkbox ${task.completed ? 'completed' : ''}" 
                         onclick="toggleTask(${index})"></div>
                    <div class="task-text ${task.completed ? 'completed' : ''}">${task.title}</div>
                `;
                tasksList.appendChild(taskItem);
            });
        }

        function toggleTask(index) {
            const task = userData.tasks.todayTasks[index];
            task.completed = !task.completed;
            
            if (task.completed) {
                // å®Œæˆä»»å‹™ç²å¾—XPå’ŒFlow
                userData.stats.XP += 20;
                userData.stats.flowState = Math.min(100, userData.stats.flowState + 10);
                
                checkLevelUp();
                checkAchievements();
            } else {
                // å–æ¶ˆå®Œæˆæ¸›å°‘Flow
                userData.stats.flowState = Math.max(0, userData.stats.flowState - 10);
            }
            
            renderTasks();
            updateUI();
            updateCharts();
            saveUserData();
        }

        function checkAchievements() {
            achievements.forEach(achievement => {
                if (!achievement.unlocked) {
                    let shouldUnlock = false;
                    
                    switch(achievement.condition) {
                        case 'checkin_1':
                            shouldUnlock = userData.progress.checkinDays.length >= 1;
                            break;
                        case 'checkin_7':
                            shouldUnlock = userData.progress.checkinDays.length >= 7;
                            break;
                        case 'level_5':
                            shouldUnlock = userData.stats.level >= 5;
                            break;
                        case 'flow_100':
                            shouldUnlock = userData.stats.flowState >= 100;
                            break;
                    }
                    
                    if (shouldUnlock) {
                        achievement.unlocked = true;
                        userData.progress.unlockedAchievements.push(achievement.id);
                        showAchievementUnlock(achievement);
                    }
                }
            });
            
            loadAchievements();
        }

        function showAchievementUnlock(achievement) {
            // å¯ä»¥æ·»åŠ æˆå°±è§£é–å‹•ç•«
            console.log(`æˆå°±è§£é–: ${achievement.title}`);
        }

        function loadAchievements() {
            const grid = document.getElementById('achievementsGrid');
            grid.innerHTML = '';
            
            achievements.forEach(achievement => {
                const badge = document.createElement('div');
                badge.className = `achievement-badge ${achievement.unlocked ? 'unlocked' : ''}`;
                badge.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-title">${achievement.title}</div>
                `;
                grid.appendChild(badge);
            });
        }

        function loadRecipes() {
            const container = document.getElementById('recipeContainer');
            container.innerHTML = '';
            
            recipes.forEach(recipe => {
                const recipeCard = document.createElement('div');
                recipeCard.className = 'recipe-card';
                recipeCard.innerHTML = `
                    <img src="${recipe.image}" alt="${recipe.title}" class="recipe-image">
                    <div class="recipe-content">
                        <div class="recipe-title">${recipe.title}</div>
                        <div class="recipe-nutrients">
                            <span>ğŸ”¥ ${recipe.calories} cal</span>
                            <span>ğŸ’ª ${recipe.protein}g è›‹ç™½è³ª</span>
                            <span>ğŸŒ¾ ${recipe.carbs}g ç¢³æ°´</span>
                            <span>ğŸ¥‘ ${recipe.fat}g è„‚è‚ª</span>
                        </div>
                        <button class="btn" onclick="addToMeal('${recipe.title}')">
                            <i class="fas fa-plus"></i> åŠ å…¥ä»Šæ—¥é£²é£Ÿ
                        </button>
                    </div>
                `;
                container.appendChild(recipeCard);
            });
        }

        function addToMeal(recipeName) {
            const recipe = recipes.find(r => r.title === recipeName);
            if (recipe) {
                userData.progress.dietHistory.push({
                    date: new Date().toISOString(),
                    recipe: recipe
                });
                
                // æ›´æ–°ç‡Ÿé¤Šåœ–è¡¨
                updateNutritionChart();
                saveUserData();
                
                alert(`${recipeName} å·²åŠ å…¥ä»Šæ—¥é£²é£Ÿï¼`);
            }
        }

        function loadLeaderboard() {
            const container = document.getElementById('leaderboardContainer');
            container.innerHTML = '';
            
            // æ·»åŠ ç•¶å‰ç”¨æˆ¶åˆ°æ’è¡Œæ¦œ
            const allUsers = [...leaderboardData, {
                name: userData.profile.name,
                avatar: userData.profile.avatarUrl,
                level: userData.stats.level,
                XP: userData.stats.XP
            }];
            
            // æ’åº
            allUsers.sort((a, b) => b.XP - a.XP);
            
            allUsers.slice(0, 10).forEach((user, index) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                item.innerHTML = `
                    <div class="rank-number ${index < 3 ? 'top3' : ''}">${index + 1}</div>
                    <img src="${user.avatar}" alt="${user.name}" class="user-avatar">
                    <div class="user-details">
                        <div class="user-name">${user.name}</div>
                        <div class="user-stats">LV ${user.level} â€¢ ${user.XP} XP</div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function updateAvatar() {
            const level = userData.stats.level;
            const avatarDisplay = document.getElementById('avatarDisplay');
            const avatarDescription = document.getElementById('avatarDescription');
            
            if (level >= 10) {
                avatarDisplay.src = "https://images.unsplash.com/photo-1581009146145-b5ef050c2e1e?w=200&h=200&fit=crop";
                avatarDescription.textContent = "æˆ°é¬¥å¤§å¸«è£å‚™";
            } else if (level >= 5) {
                avatarDisplay.src = "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=200&h=200&fit=crop";
                avatarDescription.textContent = "é‹å‹•èƒŒå¿ƒå¥—è£";
            } else {
                avatarDisplay.src = "https://images.unsplash.com/photo-1594736797933-d0f5e0822dd3?w=200&h=200&fit=crop";
                avatarDescription.textContent = "é‹å‹•æ–°æ‰‹è£å‚™";
            }
        }

        function initializeCharts() {
            // XPé€²åº¦æ¢
            const xpCtx = document.getElementById('xpChart');
            if (xpCtx) {
                xpChart = new Chart(xpCtx, {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: [userData.stats.XP, userData.stats.level * 100 - userData.stats.XP],
                            backgroundColor: ['#667eea', '#f1f3f4'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '80%',
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }

            // Flow Meter
            const flowCtx = document.getElementById('flowChart');
            if (flowCtx) {
                flowChart = new Chart(flowCtx, {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: [userData.stats.flowState, 100 - userData.stats.flowState],
                            backgroundColor: ['#ff6b6b', '#f1f3f4'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '80%',
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }

            // ç‡Ÿé¤Šåœ–è¡¨
            const nutritionCtx = document.getElementById('nutritionChart');
            if (nutritionCtx) {
                nutritionChart = new Chart(nutritionCtx, {
                    type: 'pie',
                    data: {
                        labels: ['è›‹ç™½è³ª', 'ç¢³æ°´åŒ–åˆç‰©', 'è„‚è‚ª'],
                        datasets: [{
                            data: [30, 45, 25],
                            backgroundColor: ['#667eea', '#764ba2', '#f093fb']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { fontSize: 12 }
                            }
                        }
                    }
                });
            }
        }

        function updateCharts() {
            if (xpChart) {
                const nextLevelXP = userData.stats.level * 100;
                xpChart.data.datasets[0].data = [userData.stats.XP, nextLevelXP - userData.stats.XP];
                xpChart.update();
            }
            
            if (flowChart) {
                flowChart.data.datasets[0].data = [userData.stats.flowState, 100 - userData.stats.flowState];
                flowChart.update();
            }
        }

        function updateNutritionChart() {
            if (nutritionChart && userData.progress.dietHistory.length > 0) {
                // è¨ˆç®—ä»Šæ—¥ç‡Ÿé¤Šæ”å–
                const today = new Date().toDateString();
                const todayMeals = userData.progress.dietHistory.filter(entry => 
                    new Date(entry.date).toDateString() === today
                );
                
                let totalProtein = 0, totalCarbs = 0, totalFat = 0;
                todayMeals.forEach(meal => {
                    totalProtein += meal.recipe.protein;
                    totalCarbs += meal.recipe.carbs;
                    totalFat += meal.recipe.fat;
                });
                
                const total = totalProtein + totalCarbs + totalFat;
                if (total > 0) {
                    nutritionChart.data.datasets[0].data = [
                        (totalProtein / total * 100).toFixed(1),
                        (totalCarbs / total * 100).toFixed(1),
                        (totalFat / total * 100).toFixed(1)
                    ];
                    nutritionChart.update();
                }
            }
        }

        function switchTab(tab) {
            // éš±è—æ‰€æœ‰å…§å®¹
            document.querySelectorAll('.main-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„å…§å®¹
            document.getElementById(tab + 'Content').classList.add('active');
            
            // æ›´æ–°å°èˆªç‹€æ…‹
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
        }

        function checkNetworkStatus() {
            const banner = document.getElementById('offlineBanner');
            
            function updateStatus() {
                if (!navigator.onLine) {
                    banner.style.display = 'block';
                } else {
                    banner.style.display = 'none';
                }
            }
            
            window.addEventListener('online', updateStatus);
            window.addEventListener('offline', updateStatus);
            updateStatus();
        }

        // æ·»åŠ è§¸æ‘¸æ‰‹å‹¢æ”¯æŒ
        let startY = 0;
        document.addEventListener('touchstart', function(e) {
            startY = e.touches[0].clientY;
        });

        document.addEventListener('touchmove', function(e) {
            const currentY = e.touches[0].clientY;
            const diff = startY - currentY;
            
            // å¯¦ç¾ä¸‹æ‹‰åˆ·æ–°ç­‰æ‰‹å‹¢
            if (diff < -100 && window.scrollY === 0) {
                // è§¸ç™¼åˆ·æ–°
                location.reload();
            }
        });

        // å®šæœŸä¿å­˜æ•¸æ“š
        setInterval(saveUserData, 30000); // æ¯30ç§’ä¿å­˜ä¸€æ¬¡
    </script>
</body>
</html> 