<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç†Šå“¥éºµåŒ…åŠ</title>
    <link rel="icon" href="assets/images/å°ç†Šå“¥.png" type="image/png">
    <link rel="stylesheet" href="css/style.css">
    <script>
        // æ•æ‰ç€è¦½å™¨æ“´å……åŠŸèƒ½å¼•èµ·çš„éŒ¯èª¤è¨Šæ¯
        window.addEventListener('error', function(e) {
            if (e.message && (e.message.includes('message channel closed') || 
                             e.message.includes('Extension context invalidated') ||
                             e.message.includes('asynchronous response'))) {
                e.preventDefault();
                e.stopPropagation();
                return true;
            }
        }, true);
        
        // æ•æ‰æœªè™•ç†çš„ Promise éŒ¯èª¤ï¼ˆåŠ å¼·ç‰ˆï¼‰
        window.addEventListener('unhandledrejection', function(e) {
            const errorMsg = e.reason?.message || e.reason?.toString() || '';
            if (errorMsg.includes('message channel closed') || 
                errorMsg.includes('Extension context invalidated') ||
                errorMsg.includes('asynchronous response') ||
                errorMsg.includes('listener indicated')) {
                e.preventDefault();
                e.stopPropagation();
                console.log('âš ï¸ å·²æ””æˆªç€è¦½å™¨æ“´å……åŠŸèƒ½éŒ¯èª¤ï¼ˆä¸å½±éŸ¿éŠæˆ²é‹ä½œï¼‰');
                return false;
            }
        });
        
        // é¡å¤–é˜²è­·ï¼šè¦†å¯« console.error ä¾†éæ¿¾æ“´å……åŠŸèƒ½éŒ¯èª¤
        const originalError = console.error;
        console.error = function(...args) {
            const errorStr = args.join(' ');
            if (errorStr.includes('message channel closed') || 
                errorStr.includes('asynchronous response') ||
                errorStr.includes('listener indicated') ||
                errorStr.includes('runtime.lastError') ||
                errorStr.includes('message port closed') ||
                errorStr.includes('Extension context invalidated') ||
                errorStr.includes('Unchecked runtime.lastError')) {
                console.log('âš ï¸ å·²éæ¿¾ç€è¦½å™¨æ“´å……åŠŸèƒ½éŒ¯èª¤è¨Šæ¯');
                return;
            }
            originalError.apply(console, args);
        };
        
        // ç‰¹åˆ¥è™•ç† runtime.lastError
        if (typeof chrome !== 'undefined' && chrome.runtime) {
            // éœé»˜è™•ç†æ“´å±•ç›¸é—œçš„éŒ¯èª¤
            const originalLastError = chrome.runtime.lastError;
            Object.defineProperty(chrome.runtime, 'lastError', {
                get: function() {
                    return null; // ç¸½æ˜¯è¿”å› nullï¼Œé¿å…éŒ¯èª¤
                },
                configurable: true
            });
        }
    </script>
    <!-- Botpress å°ç†ŠåŠ©æ‰‹èŠå¤©æ©Ÿå™¨äºº - æ–°é…ç½® -->
    <script src="https://cdn.botpress.cloud/webchat/v3.3/inject.js" defer></script>
    <script src="https://files.bpcontent.cloud/2025/10/25/15/20251025153516-2WWLAXAP.js" defer></script>
    <script>
        // Botpress é…ç½®ï¼ˆéš±è—é»˜èª UIï¼Œæ•´åˆåˆ°èŠå¤©å®¤ï¼‰
        window.botpressConfig = {
            botId: 'default-bot',
            clientId: 'webchat-client',
            webchatId: 'webchat-widget',
            host: 'https://cdn.botpress.cloud',
            version: '3.3',
            // èŠå¤©æ©Ÿå™¨äººè¨­å®š
            botName: 'å°ç†Šå“¥åŠ©æ‰‹',
            botAvatar: 'ğŸ»',
            // èŠå¤©å®¤è¨­å®š
            chatTitle: 'å°ç†Šå“¥éºµåŒ…åŠå®¢æœ',
            welcomeMessage: 'ä½ å¥½ï¼æˆ‘æ˜¯å°ç†Šå“¥åŠ©æ‰‹ï¼Œæœ‰ä»€éº¼å¯ä»¥å¹«åŠ©ä½ çš„å—ï¼Ÿ',
            // åŠŸèƒ½è¨­å®š
            enableFileUpload: false,
            enableVoice: false,
            // éš±è—é»˜èª UI è¨­å®š
            hideWidget: true,
            hideFAB: true,
            disableAnimations: true,
            // æ¨£å¼è¨­å®š
            theme: {
                primaryColor: '#8B4513',
                secondaryColor: '#D2B48C',
                backgroundColor: '#FFF8DC'
            }
        };
        
        // ç­‰å¾… Botpress è¼‰å…¥å®Œæˆä¸¦éš±è—é»˜èª UI
        window.addEventListener('load', function() {
            console.log('ğŸš€ é é¢è¼‰å…¥å®Œæˆï¼Œåˆå§‹åŒ– Botpressï¼ˆéš±è—é»˜èª UIï¼‰...');
            
            // å»¶é²åˆå§‹åŒ–ï¼Œç¢ºä¿æ‰€æœ‰è…³æœ¬éƒ½å·²è¼‰å…¥
            setTimeout(() => {
                if (window.botpressWebChat) {
                    console.log('âœ… Botpress WebChat å·²è¼‰å…¥');
                    try {
                        // åˆå§‹åŒ–ä½†ä¸é¡¯ç¤ºé»˜èª UI
                        window.botpressWebChat.init({
                            hideWidget: true,
                            hideFAB: true
                        });
                        console.log('âœ… Botpress WebChat åˆå§‹åŒ–æˆåŠŸï¼ˆéš±è— UIï¼‰');
                        
                        // ç«‹å³éš±è—ä»»ä½•å¯èƒ½å‡ºç¾çš„ UI å…ƒç´ 
                        setTimeout(() => {
                            hideBotpressUI();
                        }, 1000);
                        
                    } catch (error) {
                        console.log('âš ï¸ Botpress WebChat åˆå§‹åŒ–å¤±æ•—:', error);
                    }
                } else if (window.botpress) {
                    console.log('âœ… Botpress å·²è¼‰å…¥');
                    try {
                        window.botpress.init({
                            hideWidget: true,
                            hideFAB: true
                        });
                        console.log('âœ… Botpress åˆå§‹åŒ–æˆåŠŸï¼ˆéš±è— UIï¼‰');
                        
                        // ç«‹å³éš±è—ä»»ä½•å¯èƒ½å‡ºç¾çš„ UI å…ƒç´ 
                        setTimeout(() => {
                            hideBotpressUI();
                        }, 1000);
                        
                    } catch (error) {
                        console.log('âš ï¸ Botpress åˆå§‹åŒ–å¤±æ•—:', error);
                    }
                } else {
                    console.log('âš ï¸ Botpress å°šæœªè¼‰å…¥ï¼Œå°‡åœ¨èŠå¤©å®¤ä¸­è‡ªå‹•åˆå§‹åŒ–');
                }
            }, 3000); // å¢åŠ ç­‰å¾…æ™‚é–“åˆ°3ç§’
        });
        
        // éš±è— Botpress é»˜èª UI çš„å‡½æ•¸
        function hideBotpressUI() {
            console.log('ğŸš« éš±è— Botpress é»˜èª UI...');
            
            // éš±è—å¯èƒ½çš„ Botpress èŠå¤©çª—å£
            const selectors = [
                '#botpress-webchat',
                '.botpress-webchat',
                '[data-botpress]',
                '.bp-widget',
                '#bp-widget',
                '.webchat-container',
                '#webchat-container',
                '.bp-webchat',
                '#bp-webchat'
            ];
            
            selectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(element => {
                    if (element) {
                        element.style.display = 'none !important';
                        element.style.visibility = 'hidden !important';
                        element.style.opacity = '0 !important';
                        console.log(`ğŸš« éš±è— Botpress å…ƒç´ : ${selector}`);
                    }
                });
            });
            
            // éš±è—å¯èƒ½çš„æµ®å‹•æŒ‰éˆ•
            const fabSelectors = [
                '.bp-fab',
                '#bp-fab',
                '.botpress-fab',
                '.webchat-fab',
                '.bp-floating-button',
                '#bp-floating-button'
            ];
            
            fabSelectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(element => {
                    if (element) {
                        element.style.display = 'none !important';
                        element.style.visibility = 'hidden !important';
                        console.log(`ğŸš« éš±è— Botpress æµ®å‹•æŒ‰éˆ•: ${selector}`);
                    }
                });
            });
        }
    </script>
    <script>
        // è©³ç´°çš„ Botpress è¨ºæ–·å·¥å…·
        window.checkBotpressLoaded = function() {
            console.log('ğŸ” === Botpress è¨ºæ–·å·¥å…· ===');
            console.log('ğŸ” window.botpressWebChat:', typeof window.botpressWebChat, window.botpressWebChat);
            console.log('ğŸ” window.botpress:', typeof window.botpress, window.botpress);
            console.log('ğŸ” window.botpressConfig:', typeof window.botpressConfig, window.botpressConfig);
            
            // åˆ—å‡ºæ‰€æœ‰åŒ…å« 'bot' çš„å…¨å±€è®Šæ•¸
            const botGlobals = [];
            for (let key in window) {
                if (key.toLowerCase().includes('bot')) {
                    botGlobals.push(key);
                }
            }
            console.log('ğŸ” åŒ…å« "bot" çš„å…¨å±€è®Šæ•¸:', botGlobals);
            
            if (window.botpressWebChat) {
                console.log('âœ… Botpress WebChat å·²æˆåŠŸè¼‰å…¥ï¼');
                console.log('ğŸ” å¯ç”¨æ–¹æ³•:', Object.keys(window.botpressWebChat));
                return true;
            } else if (window.botpress) {
                console.log('âœ… Botpress å·²æˆåŠŸè¼‰å…¥ï¼ˆä½¿ç”¨ window.botpressï¼‰ï¼');
                console.log('ğŸ” å¯ç”¨æ–¹æ³•:', Object.keys(window.botpress));
                return true;
            } else {
                console.log('âš ï¸ Botpress WebChat å°šæœªè¼‰å…¥');
                console.log('ğŸ’¡ å»ºè­°ï¼šæª¢æŸ¥ç¶²è·¯é€£ç·šæˆ– Botpress é…ç½®æ˜¯å¦æ­£ç¢º');
                return false;
            }
        };
        
        // å¤šæ¬¡æª¢æŸ¥è¼‰å…¥ç‹€æ…‹
        let checkCount = 0;
        const checkInterval = setInterval(() => {
            checkCount++;
            console.log(`ğŸ”„ ç¬¬ ${checkCount} æ¬¡æª¢æŸ¥ Botpress...`);
            
            if (window.checkBotpressLoaded()) {
                clearInterval(checkInterval);
                console.log('ğŸ‰ Botpress æª¢æ¸¬æˆåŠŸï¼Œåœæ­¢æª¢æŸ¥');
            } else if (checkCount >= 10) {
                clearInterval(checkInterval);
                console.log('âŒ Botpress è¼‰å…¥å¤±æ•—ï¼ˆå·²æª¢æŸ¥ 10 æ¬¡ï¼‰');
                console.log('ğŸ’¡ å°‡ä½¿ç”¨å…§å»ºèŠå¤©æ©Ÿå™¨äººä½œç‚ºå‚™ç”¨æ–¹æ¡ˆ');
            }
        }, 1000);
    </script>
    <script src="js/game.js" defer></script>
</head>
<body>
    <!-- é ‚éƒ¨ç‹€æ…‹æ¬„ -->
    <header class="header">
        <!-- å·¦å´ç©å®¶è³‡è¨Š -->
        <div class="player-info">
            <div class="avatar-cell">
                <div class="player-avatar"></div>
            </div>
            <div class="name-cell">
                <div class="player-name">BEAR</div>
            </div>
        </div>
        
        <!-- å³å´è³‡æºæ¬„ -->
        <div class="resources">
            <!-- èœ‚èœœå¹£ -->
            <div class="resource-item">
                <div class="resource-icon honey-icon">
                    <div class="resource-value">10000</div>
                </div>
            </div>
            
            <!-- ç†Šé»æ•¸ -->
            <div class="resource-item">
                <div class="resource-icon bear-point-icon">
                    <div class="resource-value">100</div>
                </div>
            </div>
            
            <!-- å‹³ç«  -->
            <div class="resource-item">
                <div class="resource-icon medal-icon">
                    <div class="resource-value">100</div>
                </div>
            </div>
        </div>
    </header>

    <!-- éŠæˆ²å®¹å™¨ -->
    <div class="game-container">
        <!-- ä¸­å¤®ä¸»è¦–çª— -->
        <main class="main-window">
            <div class="window-frame">
                <div class="window-content">
                    <!-- å…§å®¹å·²æ¸…ç©º -->
                </div>
            </div>
        </main>

        <!-- åº•éƒ¨å°èˆªæ¬„ -->
        <nav class="navigation">
            <button class="nav-button" id="navGashapon">
                <span class="button-text">æ‰­è›‹æ©Ÿ</span>
            </button>
            
            <button class="nav-button" id="navStock">
                <span class="button-text">é€²è²¨</span>
            </button>
            
            <button class="nav-button" id="navMarketing">
                <span class="button-text">è¡ŒéŠ·é¡Œåº«</span>
            </button>
            
            <button class="nav-button" id="navLeaderboard">
                <span class="button-text">æ’è¡Œæ¦œ</span>
            </button>
            
            <button class="nav-button" id="navChat">
                <span class="button-text">èŠå¤©å®¤</span>
            </button>
        </nav>
    </div>

    <!-- æ’è¡Œæ¦œå½ˆçª— -->
    <div id="leaderboardModal" class="modal-overlay" style="display: none;">
        <div class="leaderboard-modal">
            <!-- æ¨™é¡Œ -->
            <div class="leaderboard-header">
                <div class="leaderboard-icon-title">
                    <img src="assets/images/æ’è¡Œæ¦œåœ–ç¤º.png" alt="æ’è¡Œæ¦œåœ–ç¤º" class="leaderboard-icon-img">
                </div>
                <h2 class="leaderboard-title">æ’è¡Œæ¦œ</h2>
            </div>
            
            <!-- æ¨™ç±¤åˆ‡æ› -->
            <div class="leaderboard-tabs">
                <button class="leaderboard-tab active" data-tab="all">èœ‚èœœå¹£</button>
                <button class="leaderboard-tab" data-tab="friends">é¡§å®¢æ»¿æ„åº¦</button>
                <button class="leaderboard-tab" data-tab="reputation">è²æœ›</button>
            </div>
            
            <!-- å‰ä¸‰åå±•ç¤ºå€ -->
            <div class="top-three-container">
                <div class="top-rank-card rank-2">
                    <div class="rank-icon">
                        <img src="assets/images/ç¬¬äºŒå.png" alt="ç¬¬äºŒå" class="rank-icon-img">
                    </div>
                    <div class="player-avatar-small">ğŸ»</div>
                    <div class="rank-name">-</div>
                    <div class="rank-score">-</div>
                </div>
                
                <div class="top-rank-card rank-1">
                    <div class="rank-icon">
                        <img src="assets/images/ç¬¬ä¸€å.png" alt="ç¬¬ä¸€å" class="rank-icon-img">
                    </div>
                    <div class="player-avatar-small">ğŸ»</div>
                    <div class="rank-name">-</div>
                    <div class="rank-score">-</div>
                </div>
                
                <div class="top-rank-card rank-3">
                    <div class="rank-icon">
                        <img src="assets/images/ç¬¬ä¸‰å.png" alt="ç¬¬ä¸‰å" class="rank-icon-img">
                    </div>
                    <div class="player-avatar-small">ğŸ»</div>
                    <div class="rank-name">-</div>
                    <div class="rank-score">-</div>
                </div>
            </div>
            
            <!-- åˆ†éš”ç·š -->
            <div class="leaderboard-divider"></div>
            
            <!-- æ’ååˆ—è¡¨ -->
            <div class="leaderboard-list">
                <div class="leaderboard-list-header">
                    <span class="header-rank">æ’å</span>
                    <span class="header-player">ç©å®¶</span>
                    <span class="header-score" id="scoreLabel">èœ‚èœœå¹£</span>
                </div>
                
                <div class="leaderboard-list-content">
                    <div class="leaderboard-item">
                        <span class="item-rank">#4</span>
                        <span class="item-player">-</span>
                        <span class="item-score">-</span>
                    </div>
                    
                    <div class="leaderboard-item">
                        <span class="item-rank">#5</span>
                        <span class="item-player">-</span>
                        <span class="item-score">-</span>
                    </div>
                    
                    <div class="leaderboard-item">
                        <span class="item-rank">#6</span>
                        <span class="item-player">-</span>
                        <span class="item-score">-</span>
                    </div>
                    
                    <div class="leaderboard-item">
                        <span class="item-rank">#7</span>
                        <span class="item-player">-</span>
                        <span class="item-score">-</span>
                    </div>
                    
                    <div class="leaderboard-item">
                        <span class="item-rank">#8</span>
                        <span class="item-player">-</span>
                        <span class="item-score">-</span>
                    </div>
                </div>
            </div>
            
            <!-- åº•éƒ¨æŒ‰éˆ• -->
            <div class="leaderboard-footer">
                <button class="leaderboard-btn refresh-btn">ğŸ”„ åˆ·æ–°æ’è¡Œæ¦œ</button>
                <button class="leaderboard-btn close-btn">é—œé–‰</button>
            </div>
        </div>
    </div>

    <!-- èƒŒæ™¯éŸ³æ¨‚ -->
    <audio id="backgroundMusic" loop>
        <source src="assets/music/nostalgia2-fast.mp3" type="audio/mpeg">
        æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³é »æ’­æ”¾ã€‚
    </audio>
</body>
</html>
