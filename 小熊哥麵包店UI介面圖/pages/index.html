<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç†Šå“¥éºµåŒ…åŠ</title>
    <link rel="stylesheet" href="../styles/styles.css">
    
    <script type="module" src="../scripts/modules/audio.js"></script>
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <style>
        @font-face {
            font-family: 'Zpix';
            src: url('../assets/fonts/Zpix.ttf') format('truetype');
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Zpix', 'Press Start 2P', monospace;
            background: url('../assets/backgrounds/ç™»å…¥èƒŒæ™¯2.gif') center center / cover no-repeat;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        
        /* ä¸»è¦å®¹å™¨ */
        .main-container {
            text-align: center;
            z-index: 10;
            position: relative;
            padding: 40px 40px 60px 40px;
            margin-top: -100px;
        }
        
        /* ä¸»æ¨™é¡Œåœ–ç‰‡ */
        .title-image {
            width: 500px;
            max-width: 90vw;
            height: auto;
            margin-bottom: 30px;
            filter: drop-shadow(4px 4px 8px rgba(0, 0, 0, 0.3));
            animation: titleFloat 3s ease-in-out infinite alternate;
        }
        
        @keyframes titleFloat {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-10px); }
        }
        
        /* æŒ‰éˆ•å®¹å™¨ */
        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .menu-btn {
            padding: 20px 60px;
            font-family: 'Zpix', monospace;
            font-size: 18px;
            background: linear-gradient(145deg, #DEB887, #CD853F);
            color: white;
            border: 4px solid #B8860B;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 6px 0 #8B7355,
                0 8px 20px rgba(0,0,0,0.3);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.3);
            min-width: 300px;
            position: relative;
            overflow: hidden;
        }
        
        .menu-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }
        
        .menu-btn:hover:before {
            left: 100%;
        }
        
        .menu-btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 9px 0 #8B7355,
                0 12px 25px rgba(0,0,0,0.4);
            background: linear-gradient(145deg, #F4A460, #DEB887);
        }
        
        .menu-btn:active {
            transform: translateY(3px);
            box-shadow: 
                0 3px 0 #8B7355,
                0 5px 10px rgba(0,0,0,0.3);
        }
        
        /* ç‰¹æ®ŠæŒ‰éˆ•é¡è‰² */
        .menu-btn.start-game {
            background: linear-gradient(145deg, #DAA520, #B8860B);
            border-color: #CD853F;
            box-shadow: 0 6px 0 #8B7355, 0 8px 20px rgba(0,0,0,0.3);
        }
        
        .menu-btn.start-game:hover {
            background: linear-gradient(145deg, #F4A460, #DAA520);
            box-shadow: 0 9px 0 #8B7355, 0 12px 25px rgba(0,0,0,0.4);
        }
        
        .menu-btn.start-game:active {
            box-shadow: 0 3px 0 #8B7355, 0 5px 10px rgba(0,0,0,0.3);
        }
        
        .menu-btn.quit {
            background: linear-gradient(145deg, #CD5C5C, #B22222);
            border-color: #8B0000;
            box-shadow: 0 6px 0 #600000, 0 8px 20px rgba(0,0,0,0.3);
        }
        
        .menu-btn.quit:hover {
            background: linear-gradient(145deg, #DC143C, #CD5C5C);
            box-shadow: 0 9px 0 #600000, 0 12px 25px rgba(0,0,0,0.4);
        }
        
        .menu-btn.quit:active {
            box-shadow: 0 3px 0 #600000, 0 5px 10px rgba(0,0,0,0.3);
        }
        
        /* è¨­å®šé¢æ¿è¦†è“‹å±¤ */
        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .settings-panel {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 4px solid #2c3e50;
        }
        
        .settings-panel h2 {
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
            font-size: 24px;
        }
        
        .setting-item {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .setting-item label {
            color: #2c3e50;
            font-size: 14px;
        }
        
        .setting-item input[type="range"] {
            width: 150px;
        }
        
        .account-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .menu-btn.login-setting,
        .menu-btn.register-setting {
            padding: 8px 16px;
            font-size: 12px;
            margin: 0;
            min-width: auto;
            flex: 1;
        }
        
        .menu-btn.login-setting {
            background: linear-gradient(145deg, #D2691E, #A0522D);
            border-color: #8B4513;
            box-shadow: 0 3px 0 #654321, 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .menu-btn.login-setting:hover {
            background: linear-gradient(145deg, #F4A460, #D2691E);
            box-shadow: 0 4px 0 #654321, 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .menu-btn.register-setting {
            background: linear-gradient(145deg, #BC9A6A, #8B7355);
            border-color: #654321;
            box-shadow: 0 3px 0 #3E2723, 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .menu-btn.register-setting:hover {
            background: linear-gradient(145deg, #DEB887, #BC9A6A);
            box-shadow: 0 4px 0 #3E2723, 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .close-settings {
            background: linear-gradient(145deg, #A0826D, #8B7765);
            border-color: #654321;
            box-shadow: 0 4px 0 #3E2723, 0 6px 15px rgba(0,0,0,0.2);
            margin-top: 20px;
            width: 100%;
        }
        
        .close-settings:hover {
            background: linear-gradient(145deg, #BC9A6A, #A0826D);
            box-shadow: 0 6px 0 #3E2723, 0 8px 20px rgba(0,0,0,0.3);
        }
        
        /* ç™»å…¥ç‹€æ…‹æç¤º */
        .login-status {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: rgba(46, 204, 113, 0.9);
            color: white;
            border-radius: 20px;
            font-size: 12px;
            display: none;
        }
        
        .login-status.logged-out {
            background: rgba(231, 76, 60, 0.9);
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .main-container {
                padding: 40px 20px;
            }
            
            .title-image {
                width: 400px;
                margin-bottom: 40px;
            }
            
            .menu-btn {
                padding: 15px 40px;
                font-size: 16px;
                min-width: 250px;
            }
        }
        
        @media (max-width: 480px) {
            .title-image {
                width: 300px;
                margin-bottom: 30px;
            }
            
            .menu-btn {
                padding: 12px 30px;
                font-size: 14px;
                min-width: 200px;
            }
        }
    </style>
</head>
<body>
    
    <!-- ä¸»è¦å…§å®¹ -->
    <div class="main-container">
        <!-- ä¸»æ¨™é¡Œåœ–ç‰‡ -->
        <img src="../assets/images/Bear&Bread.png" alt="å°ç†Šå“¥éºµåŒ…åº—" class="title-image">
        
        <!-- èœå–®æŒ‰éˆ• -->
        <div class="menu-buttons">
            <button class="menu-btn start-game" id="startGameBtn">START GAME</button>
            <button class="menu-btn options" id="optionsBtn">OPTIONS</button>
            <button class="menu-btn quit" id="quitBtn">QUIT</button>
        </div>
    </div>
    
    <!-- è¨­å®šé¢æ¿è¦†è“‹å±¤ -->
    <div class="settings-overlay" id="settingsOverlay">
        <div class="settings-panel">
            <h2>éŠæˆ²è¨­å®š</h2>
            <div class="setting-item">
                <label for="musicVolume">èƒŒæ™¯éŸ³æ¨‚éŸ³é‡</label>
                <input type="range" id="musicVolume" min="0" max="100" value="50">
                <span id="volumeValue">50%</span>
            </div>
            <div class="setting-item">
                <label for="sfxVolume">éŸ³æ•ˆéŸ³é‡</label>
                <input type="range" id="sfxVolume" min="0" max="100" value="70">
                <span id="sfxVolumeValue">70%</span>
            </div>
            <div class="setting-item">
                <label>éŸ³æ•ˆ</label>
                <input type="checkbox" id="soundEffects" checked>
            </div>
            <div class="setting-item">
                <label>èƒŒæ™¯éŸ³æ¨‚ï¼š</label>
                <input type="checkbox" id="backgroundMusic" checked>
                <span id="musicStatus">ğŸµ æ’­æ”¾ä¸­</span>
            </div>
            <div class="setting-item">
                <label>äº®åº¦ï¼š</label>
                <input type="range" id="brightness" min="30" max="150" value="100" step="10">
            </div>
            <div class="setting-item">
                <label>å¸³è™Ÿç®¡ç†ï¼š</label>
                <div class="account-buttons">
                    <button class="menu-btn login-setting" id="loginSetting">ç™»å…¥</button>
                    <button class="menu-btn register-setting" id="registerSetting">è¨»å†Š</button>
                </div>
            </div>
            <button class="menu-btn close-settings" id="closeSettings">é—œé–‰è¨­å®š</button>
        </div>
    </div>

    <!-- START GAME å°ˆç”¨è‡ªè¨‚å½ˆçª— -->
    <div id="start-modal" class="player-modal hidden">
      <div class="player-modal-content">
        <h2 class="modal-title">æ­¡è¿ä¾†åˆ°å°ç†Šå“¥éºµåŒ…åº—ï¼</h2>
        <div class="modal-desc">è«‹é¸æ“‡æ‚¨çš„éŠæˆ²æ¨¡å¼ï¼š</div>
        <ul class="modal-mode-list">
          <li><b>ç™»å…¥æ¨¡å¼ï¼š</b>ä¿å­˜é€²åº¦ã€å®Œæ•´é«”é©—ã€æˆå°±ç³»çµ±</li>
          <li><b>è¨ªå®¢æ¨¡å¼ï¼š</b>é«”é©—éŠæˆ²ä½†ä¸ä¿å­˜é€²åº¦</li>
        </ul>
        <div class="modal-actions">
          <button id="login-btn" class="menu-btn start-game">ç™»å…¥</button>
          <button id="guest-btn" class="menu-btn">è¨ªå®¢</button>
        </div>
      </div>
    </div>
    <!-- END START GAME å°ˆç”¨è‡ªè¨‚å½ˆçª— -->

    <script>
        // éŠæˆ²ç‹€æ…‹ç®¡ç†
        let gameState = {
            isLoggedIn: false,
            isGuestMode: false,
            playerData: {
                name: '',
                email: '',
                avatar: 'ğŸ§‘â€ğŸ³',
                level: 1,
                coins: 1000,
                experience: 0
            },
            settings: {
                musicVolume: 50,
                soundEffects: true,
                backgroundMusic: true,
                brightness: 100,
                sfxVolume: 70
            }
        };

        // ä¸»åˆå§‹åŒ–æµç¨‹
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ å°é¢é é¢åˆå§‹åŒ–é–‹å§‹');
            checkSavedLoginState();
            checkLoginStatus();
            setupEventListeners();
            loadSettings();
            setTimeout(() => {
                if (window.musicManager) {
                    if (gameState.settings.backgroundMusic && window.musicManager.musicEnabled) {
                        console.log('ğŸµ æº–å‚™æ’­æ”¾ä¸»é¡ŒéŸ³æ¨‚ï¼ˆç­‰å¾…ç”¨æˆ¶äº’å‹•ï¼‰');
                    }
                    console.log('ğŸµ éŸ³æ¨‚ç®¡ç†å™¨ç‹€æ…‹:', window.musicManager.getStatus());
                }
            }, 500);
            console.log('âœ… åˆå§‹åŒ–å®Œæˆ');
            console.log('æœ€çµ‚éŠæˆ²ç‹€æ…‹:', gameState);
        });

        // æª¢æŸ¥å„²å­˜çš„ç™»å…¥ç‹€æ…‹
        function checkSavedLoginState() {
            const savedState = localStorage.getItem('bearBakeryGameState');
            if (savedState) {
                try {
                    const parsedState = JSON.parse(savedState);
                    
                    // åªæœ‰åœ¨çœŸæ­£ç™»å…¥æ™‚æ‰è¼‰å…¥ç‹€æ…‹
                    if (parsedState.isLoggedIn && !parsedState.isGuestMode && parsedState.playerData && parsedState.playerData.email && parsedState.playerData.email !== 'guest@bearBakery.com') {
                        gameState = {
                            ...gameState,
                            ...parsedState,
                            settings: { ...gameState.settings, ...(parsedState.settings || {}) },
                            playerData: { ...gameState.playerData, ...(parsedState.playerData || {}) }
                        };
                        console.log('è¼‰å…¥å·²ç™»å…¥ç”¨æˆ¶ç‹€æ…‹:', gameState.playerData.name);
                    } else {
                        console.log('æª¢æ¸¬åˆ°è¨ªå®¢æ¨¡å¼æˆ–æœªç™»å…¥ç‹€æ…‹ï¼Œä¿æŒé è¨­æœªç™»å…¥ç‹€æ…‹');
                        // æ¸…é™¤è¨ªå®¢æ¨¡å¼ï¼Œé‡æ–°é–‹å§‹
                        localStorage.removeItem('bearBakeryGameState');
                    }
                } catch (error) {
                    console.error('è¼‰å…¥ç‹€æ…‹å¤±æ•—:', error);
                    localStorage.removeItem('bearBakeryGameState');
                }
            } else {
                console.log('æœªæ‰¾åˆ°å„²å­˜ç‹€æ…‹ï¼Œä½¿ç”¨é è¨­æœªç™»å…¥ç‹€æ…‹');
            }
        }

        // å„²å­˜éŠæˆ²ç‹€æ…‹
        function saveGameState() {
            localStorage.setItem('bearBakeryGameState', JSON.stringify(gameState));
            console.log('éŠæˆ²ç‹€æ…‹å·²å„²å­˜');
        }

        // è¨­å®šäº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            // START GAME æŒ‰éˆ• - é¡¯ç¤ºè‡ªè¨‚å½ˆçª—
            document.getElementById('startGameBtn').addEventListener('click', function() {
                playClickSound();
                document.getElementById('start-modal').classList.remove('hidden');
            });

            // ç¶å®šç™»å…¥/è¨ªå®¢æŒ‰éˆ•
            document.getElementById('login-btn').onclick = function() {
                document.getElementById('start-modal').classList.add('hidden');
                window.location.href = 'login.html';
            };
            document.getElementById('guest-btn').onclick = function() {
                document.getElementById('start-modal').classList.add('hidden');
                startGuestMode();
            };

            // OPTIONS æŒ‰éˆ•
            document.getElementById('optionsBtn').addEventListener('click', function() {
                playClickSound();
                showSettings();
            });

            // QUIT æŒ‰éˆ•
            document.getElementById('quitBtn').addEventListener('click', function() {
                playClickSound();
                
                const confirmQuit = confirm('ç¢ºå®šè¦é›¢é–‹éŠæˆ²å—ï¼Ÿ');
                if (confirmQuit) {
                    // ä¿å­˜ç•¶å‰éŠæˆ²ç‹€æ…‹
                    if (gameState.isLoggedIn) {
                        saveGameState();
                    }
                    
                    // å˜—è©¦é—œé–‰è¦–çª—
                    try {
                        window.close();
                        // å¦‚æœç„¡æ³•é—œé–‰ï¼Œé¡¯ç¤ºæ›¿ä»£è¨Šæ¯
                        setTimeout(() => {
                            alert('æ„Ÿè¬æ‚¨éŠç©å°ç†Šå“¥éºµåŒ…åº—ï¼ğŸ\n\nè«‹æ‰‹å‹•é—œé–‰æ­¤åˆ†é ã€‚');
                        }, 100);
                    } catch (error) {
                        alert('æ„Ÿè¬æ‚¨éŠç©å°ç†Šå“¥éºµåŒ…åº—ï¼ğŸ\n\nè«‹æ‰‹å‹•é—œé–‰æ­¤åˆ†é ã€‚');
                    }
                }
            });

            // é—œé–‰è¨­å®šæŒ‰éˆ•
            document.getElementById('closeSettings').addEventListener('click', function() {
                playClickSound();
                hideSettings();
            });

            // è¨­å®šé¢æ¿ä¸­çš„ç™»å…¥æŒ‰éˆ•
            document.getElementById('loginSetting').addEventListener('click', function() {
                playClickSound();
                hideSettings();
                window.location.href = 'login.html';
            });

            // è¨­å®šé¢æ¿ä¸­çš„è¨»å†ŠæŒ‰éˆ•
            document.getElementById('registerSetting').addEventListener('click', function() {
                playClickSound();
                hideSettings();
                window.location.href = 'register.html';
            });

            // è¨­å®šé¢æ¿é»æ“Šå¤–éƒ¨é—œé–‰
            document.getElementById('settingsOverlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideSettings();
                }
            });

            // è¨­å®šé …ç›®è®Šæ›´äº‹ä»¶
            document.getElementById('musicVolume').addEventListener('input', function() {
                const volume = parseInt(this.value) / 100;
                gameState.settings.musicVolume = this.value;
                
                // æ›´æ–°éŸ³æ¨‚ç®¡ç†å™¨éŸ³é‡
                if (window.musicManager) {
                    window.musicManager.setVolume(volume);
                }
                
                // æ›´æ–°é¡¯ç¤º
                document.getElementById('volumeValue').textContent = this.value + '%';
                
                saveGameState();
            });

            document.getElementById('soundEffects').addEventListener('change', function() {
                gameState.settings.soundEffects = this.checked;
                saveGameState();
            });

            document.getElementById('backgroundMusic').addEventListener('change', function() {
                gameState.settings.backgroundMusic = this.checked;
                
                // æ§åˆ¶éŸ³æ¨‚ç®¡ç†å™¨
                if (window.musicManager) {
                    if (this.checked) {
                        window.musicManager.musicEnabled = true;
                        window.musicManager.play('main');
                        document.getElementById('musicStatus').textContent = 'ğŸµ æ’­æ”¾ä¸­';
                    } else {
                        window.musicManager.musicEnabled = false;
                        window.musicManager.stop();
                        document.getElementById('musicStatus').textContent = 'ğŸ”‡ å·²é—œé–‰';
                    }
                    window.musicManager.saveSettings();
                }
                
                saveGameState();
            });

            document.getElementById('brightness').addEventListener('input', function() {
                gameState.settings.brightness = parseInt(this.value);
                applyBrightnessSetting(parseInt(this.value));
                saveGameState();
            });

            document.getElementById('sfxVolume').addEventListener('input', function() {
                const value = parseInt(this.value);
                window.musicManager.setSfxVolume(value / 100);
                document.getElementById('sfxVolumeValue').textContent = value + '%';
                saveGameState();
            });
        }

        // é¡¯ç¤ºè¨­å®šé¢æ¿
        function showSettings() {
            document.getElementById('settingsOverlay').style.display = 'flex';
            loadSettings();
        }

        // éš±è—è¨­å®šé¢æ¿
        function hideSettings() {
            document.getElementById('settingsOverlay').style.display = 'none';
        }

        // è¼‰å…¥è¨­å®šåˆ°UI
        function loadSettings() {
            // å¾éŸ³æ¨‚ç®¡ç†å™¨åŒæ­¥è¨­å®š
            if (window.musicManager) {
                const musicStatus = window.musicManager.getStatus();
                gameState.settings.backgroundMusic = musicStatus.musicEnabled;
                gameState.settings.musicVolume = Math.round(musicStatus.volume * 100);
                gameState.settings.sfxVolume = Math.round((musicStatus.sfxVolume ?? 0.7) * 100);
            }
            
            document.getElementById('musicVolume').value = gameState.settings.musicVolume;
            document.getElementById('volumeValue').textContent = gameState.settings.musicVolume + '%';
            document.getElementById('soundEffects').checked = gameState.settings.soundEffects;
            document.getElementById('backgroundMusic').checked = gameState.settings.backgroundMusic;
            document.getElementById('musicStatus').textContent = gameState.settings.backgroundMusic ? 'ğŸµ æ’­æ”¾ä¸­' : 'ğŸ”‡ å·²é—œé–‰';
            document.getElementById('brightness').value = gameState.settings.brightness || 100;
            applyBrightnessSetting(gameState.settings.brightness || 100);
            document.getElementById('sfxVolume').value = gameState.settings.sfxVolume ?? 70;
            document.getElementById('sfxVolumeValue').textContent = (gameState.settings.sfxVolume ?? 70) + '%';
        }

        // æ‡‰ç”¨äº®åº¦è¨­å®š
        function applyBrightnessSetting(brightness) {
            const body = document.body;
            // å°‡æ»‘æ¡¿å€¼(30-150)è½‰æ›ç‚ºCSS brightnesså€¼(0.3-1.5)
            const brightnessValue = brightness / 100;
            body.style.filter = `brightness(${brightnessValue})`;
        }

        // éŸ³æ•ˆæ’­æ”¾åŠŸèƒ½
        function playClickSound() {
            if (!gameState.settings.soundEffects) return;
            
            // å‰µå»ºç°¡å–®çš„é»æ“ŠéŸ³æ•ˆ
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (error) {
                console.log('éŸ³æ•ˆæ’­æ”¾å¤±æ•—:', error);
            }
        }

        // æª¢æŸ¥URLåƒæ•¸æ˜¯å¦æœ‰ç™»å…¥ç‹€æ…‹
        function checkLoginStatus() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('logged_in') === 'true') {
                const name = urlParams.get('name') || 'ç©å®¶';
                const email = urlParams.get('email') || '';
                
                console.log('æª¢æ¸¬åˆ°ç™»å…¥URLåƒæ•¸:', { name, email });
                
                // è¨­å®šçœŸå¯¦ç™»å…¥ç‹€æ…‹
                gameState.isLoggedIn = true;
                gameState.isGuestMode = false;
                gameState.playerData.name = name;
                gameState.playerData.email = email;
                gameState.playerData.avatar = 'ğŸ§‘â€ğŸ³';
                gameState.playerData.level = 1;
                gameState.playerData.coins = 1000;
                gameState.playerData.experience = 0;
                
                // å„²å­˜ç‹€æ…‹
                saveGameState();
                
                // æ¸…é™¤URLåƒæ•¸
                window.history.replaceState({}, document.title, window.location.pathname);
                
                // é¡¯ç¤ºæ­¡è¿è¨Šæ¯
                alert(`ğŸ‰ æ­¡è¿å›ä¾†ï¼Œ${name}ï¼\n\næ‚¨å·²æˆåŠŸç™»å…¥å°ç†Šå“¥éºµåŒ…åº—ã€‚`);
                
                // è‡ªå‹•é€²å…¥éŠæˆ²é 
                enterGame();
            }
        }

        // é–‹å§‹è¨ªå®¢æ¨¡å¼
        function startGuestMode() {
            console.log('ğŸ® é–‹å§‹è¨ªå®¢æ¨¡å¼');
            
            // è¨­å®šè¨ªå®¢ç‹€æ…‹
            gameState.isLoggedIn = true;
            gameState.isGuestMode = true;
            gameState.playerData.name = 'è¨ªå®¢ç©å®¶';
            gameState.playerData.email = 'guest@bearBakery.com';
            gameState.playerData.avatar = 'ğŸ‘¤';
            gameState.playerData.level = 1;
            gameState.playerData.coins = 1000;
            gameState.playerData.experience = 0;
            
            // å„²å­˜ç‹€æ…‹
            saveGameState();
            
            // é¡¯ç¤ºæ­¡è¿è¨Šæ¯
            alert('ğŸ‰ æ­¡è¿è¨ªå®¢ç©å®¶ï¼\n\næ‚¨ç¾åœ¨å¯ä»¥é«”é©—éŠæˆ²åŸºæœ¬åŠŸèƒ½ã€‚\næƒ³è¦å®Œæ•´é«”é©—è«‹è¨»å†Šå¸³è™Ÿã€‚');
            
            // é€²å…¥éŠæˆ²
            enterGame();
        }

        // é€²å…¥éŠæˆ²
        function enterGame() {
            saveGameState(); // ç¢ºä¿æœ€æ–°ç‹€æ…‹å·²å¯«å…¥
            console.log('ğŸ® é€²å…¥éŠæˆ²é é¢');
            try {
                window.location.href = 'MyPerfectGame.html';
            } catch (error) {
                console.error('è·³è½‰å¤±æ•—:', error);
                window.open('MyPerfectGame.html', '_self');
            }
        }
    </script>
</body>
</html> 