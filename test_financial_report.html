<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²¡å‹™å ±è¡¨ä¿®å¾©æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .debug-button {
            background: #2196F3;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .debug-button:hover {
            background: #1976D2;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ è²¡å‹™å ±è¡¨ä¿®å¾©æ¸¬è©¦</h1>
    
    <div class="test-container">
        <h2>æ¸¬è©¦èªªæ˜</h2>
        <p>æ­¤é é¢ç”¨æ–¼æ¸¬è©¦è²¡å‹™å ±è¡¨ä¿®å¾©åŠŸèƒ½ã€‚è«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿé€²è¡Œæ¸¬è©¦ï¼š</p>
        <ol>
            <li>é»æ“Šã€Œè¼‰å…¥éŠæˆ²ã€æŒ‰éˆ•è¼‰å…¥éŠæˆ²é‚è¼¯</li>
            <li>é»æ“Šã€Œæ¨¡æ“¬å®Œæˆç¬¬ä¸€è¼ªã€æŒ‰éˆ•æ¨¡æ“¬å®Œæˆç¬¬ä¸€è¼ªéŠæˆ²</li>
            <li>é»æ“Šã€Œæª¢æŸ¥è²¡å‹™å ±è¡¨ã€æŒ‰éˆ•æª¢æŸ¥è²¡å‹™å ±è¡¨ç‹€æ…‹</li>
            <li>å¦‚æœç™¼ç¾å•é¡Œï¼Œé»æ“Šã€Œä¿®å¾©è²¡å‹™å ±è¡¨ã€æŒ‰éˆ•</li>
            <li>å†æ¬¡æª¢æŸ¥è²¡å‹™å ±è¡¨ç‹€æ…‹</li>
        </ol>
    </div>

    <div class="test-container">
        <h2>æ¸¬è©¦æ§åˆ¶</h2>
        <button class="test-button" onclick="loadGame()">è¼‰å…¥éŠæˆ²</button>
        <button class="test-button" onclick="simulateFirstRound()">æ¨¡æ“¬å®Œæˆç¬¬ä¸€è¼ª</button>
        <button class="debug-button" onclick="checkFinancialReport()">æª¢æŸ¥è²¡å‹™å ±è¡¨</button>
        <button class="debug-button" onclick="fixFinancialReport()">ä¿®å¾©è²¡å‹™å ±è¡¨</button>
        <button class="debug-button" onclick="clearTestData()">æ¸…é™¤æ¸¬è©¦æ•¸æ“š</button>
    </div>

    <div class="test-container">
        <h2>æ¸¬è©¦çµæœ</h2>
        <div id="test-results"></div>
    </div>

    <script>
        let gameLoaded = false;

        function log(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            resultsDiv.appendChild(statusDiv);
            console.log(message);
        }

        function loadGame() {
            try {
                // è¼‰å…¥éŠæˆ²è…³æœ¬
                const script = document.createElement('script');
                script.src = 'js/game.js';
                script.onload = function() {
                    gameLoaded = true;
                    log('âœ… éŠæˆ²è¼‰å…¥æˆåŠŸ', 'success');
                };
                script.onerror = function() {
                    log('âŒ éŠæˆ²è¼‰å…¥å¤±æ•—', 'error');
                };
                document.head.appendChild(script);
            } catch (error) {
                log(`âŒ è¼‰å…¥éŠæˆ²æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
            }
        }

        function simulateFirstRound() {
            if (!gameLoaded) {
                log('âŒ è«‹å…ˆè¼‰å…¥éŠæˆ²', 'error');
                return;
            }

            try {
                // æ¨¡æ“¬å®Œæˆç¬¬ä¸€è¼ªéŠæˆ²
                if (window.GameFlowManager && window.FinancialReport) {
                    // è¨­ç½®ç¬¬ä¸€è¼ª
                    GameFlowManager.currentRound = 1;
                    GameFlowManager.eventsCompleted = 7;
                    GameFlowManager.totalEventsPerRound = 7;
                    
                    // æ¨¡æ“¬7å€‹äº‹ä»¶
                    for (let i = 0; i < 7; i++) {
                        FinancialReport.recordEvent({
                            eventTitle: `æ¸¬è©¦äº‹ä»¶ ${i + 1}`,
                            revenue: 1000 + (i * 100),
                            cost: 500 + (i * 50),
                            salesVolume: 10 + i,
                            satisfactionChange: 5,
                            reputationChange: 3
                        });
                    }
                    
                    // è¨­ç½®åœ°å€ä¿¡æ¯
                    FinancialReport.setRegionInfo('ä½å®…å€', 'æ¸¬è©¦è¡Œæ”¿å€', 1000);
                    
                    log('âœ… ç¬¬ä¸€è¼ªæ¨¡æ“¬å®Œæˆ', 'success');
                    log(`   äº‹ä»¶æ•¸é‡: ${FinancialReport.currentRoundData.events.length}`, 'info');
                    log(`   ç¸½æ”¶å…¥: ${FinancialReport.currentRoundData.totalRevenue}`, 'info');
                    log(`   ç¸½æˆæœ¬: ${FinancialReport.currentRoundData.totalCost}`, 'info');
                } else {
                    log('âŒ éŠæˆ²ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                }
            } catch (error) {
                log(`âŒ æ¨¡æ“¬ç¬¬ä¸€è¼ªæ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
            }
        }

        function checkFinancialReport() {
            if (!gameLoaded) {
                log('âŒ è«‹å…ˆè¼‰å…¥éŠæˆ²', 'error');
                return;
            }

            try {
                if (window.FinancialReport && window.GameFlowManager) {
                    log('ğŸ“Š è²¡å‹™å ±è¡¨ç‹€æ…‹æª¢æŸ¥:', 'info');
                    log(`   ç•¶å‰è¼ªæ¬¡: ${GameFlowManager.currentRound}`, 'info');
                    log(`   å·²å®Œæˆäº‹ä»¶: ${GameFlowManager.eventsCompleted}`, 'info');
                    log(`   ç•¶å‰è¼ªæ¬¡äº‹ä»¶æ•¸: ${FinancialReport.currentRoundData.events.length}`, 'info');
                    log(`   å ±è¡¨æ­·å²æ•¸é‡: ${FinancialReport.history.length}`, 'info');
                    
                    // æª¢æŸ¥æ˜¯å¦æœ‰ç•¶å‰è¼ªæ¬¡çš„å ±è¡¨
                    const hasCurrentRoundReport = FinancialReport.history.some(
                        report => report.roundNumber === GameFlowManager.currentRound
                    );
                    
                    if (hasCurrentRoundReport) {
                        log('âœ… æ‰¾åˆ°ç•¶å‰è¼ªæ¬¡çš„è²¡å‹™å ±è¡¨', 'success');
                    } else {
                        log('âš ï¸ æ²’æœ‰æ‰¾åˆ°ç•¶å‰è¼ªæ¬¡çš„è²¡å‹™å ±è¡¨', 'error');
                    }
                    
                    // é¡¯ç¤ºæ‰€æœ‰å ±è¡¨
                    if (FinancialReport.history.length > 0) {
                        log('ğŸ“‹ æ‰€æœ‰è²¡å‹™å ±è¡¨:', 'info');
                        FinancialReport.history.forEach((report, index) => {
                            log(`   å ±è¡¨ ${index + 1}: ç¬¬${report.roundNumber}è¼ª, æ·¨åˆ©: ${report.netProfit}`, 'info');
                        });
                    } else {
                        log('âŒ æ²’æœ‰ä»»ä½•è²¡å‹™å ±è¡¨', 'error');
                    }
                } else {
                    log('âŒ è²¡å‹™å ±è¡¨ç³»çµ±æœªåˆå§‹åŒ–', 'error');
                }
            } catch (error) {
                log(`âŒ æª¢æŸ¥è²¡å‹™å ±è¡¨æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
            }
        }

        function fixFinancialReport() {
            if (!gameLoaded) {
                log('âŒ è«‹å…ˆè¼‰å…¥éŠæˆ²', 'error');
                return;
            }

            try {
                if (window.FinancialReport) {
                    const fixed = FinancialReport.fixFinancialReport();
                    if (fixed) {
                        log('âœ… è²¡å‹™å ±è¡¨ä¿®å¾©æˆåŠŸ', 'success');
                    } else {
                        log('â„¹ï¸ è²¡å‹™å ±è¡¨ç‹€æ…‹æ­£å¸¸ï¼Œç„¡éœ€ä¿®å¾©', 'info');
                    }
                } else {
                    log('âŒ è²¡å‹™å ±è¡¨ç³»çµ±æœªåˆå§‹åŒ–', 'error');
                }
            } catch (error) {
                log(`âŒ ä¿®å¾©è²¡å‹™å ±è¡¨æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
            }
        }

        function clearTestData() {
            if (!gameLoaded) {
                log('âŒ è«‹å…ˆè¼‰å…¥éŠæˆ²', 'error');
                return;
            }

            try {
                // æ¸…é™¤è²¡å‹™å ±è¡¨æ•¸æ“š
                localStorage.removeItem('financialReport');
                localStorage.removeItem('gameProgress');
                
                // é‡ç½®è²¡å‹™å ±è¡¨
                if (window.FinancialReport) {
                    FinancialReport.history = [];
                    FinancialReport.resetCurrentRound();
                }
                
                // é‡ç½®éŠæˆ²æµç¨‹
                if (window.GameFlowManager) {
                    GameFlowManager.currentRound = 1;
                    GameFlowManager.eventsCompleted = 0;
                }
                
                log('âœ… æ¸¬è©¦æ•¸æ“šå·²æ¸…é™¤', 'success');
            } catch (error) {
                log(`âŒ æ¸…é™¤æ¸¬è©¦æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
